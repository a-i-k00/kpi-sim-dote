<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ãƒ‰ãƒ†ãƒ©ç›®æ¨™é”æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=M+PLUS+Rounded+1c:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet" />
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Annotation Plugin -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
  <style>
    /* ãƒªã‚»ãƒƒãƒˆï¼†ãƒ™ãƒ¼ã‚¹ã‚¹ã‚¿ã‚¤ãƒ« */
    *, *::before, *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html {
      font-size: 16px;
    }
    body {
      font-family: 'M PLUS Rounded 1c', 'Noto Sans JP', 'Roboto', sans-serif;
      /* Y2Ké¢¨ã®æ˜ã‚‹ã„ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ã«å¤‰æ›´ */
      background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
      color: #333333;
      padding: 20px;
      line-height: 1.6;
      min-height: 100vh;
    }
    h1, h2, h3 {
      margin-bottom: 10px;
      font-weight: 700;
      font-family: 'M PLUS Rounded 1c', 'Roboto', sans-serif;
    }
    h1 {
      text-align: center;
      /* ãƒã‚ªãƒ³ã‚«ãƒ©ãƒ¼ã‚¿ãƒƒãƒã®ã‚¿ã‚¤ãƒˆãƒ« */
      color: #6a11cb;
      margin-bottom: 20px;
      position: relative;
      padding-bottom: 10px;
      /* å¤§èƒ†ãªãƒ•ã‚©ãƒ³ãƒˆã‚¹ã‚¿ã‚¤ãƒ« */
      font-size: 2.5rem;
      letter-spacing: -0.5px;
    }
    h1:after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 4px;
      /* ãƒã‚ªãƒ³ã‚«ãƒ©ãƒ¼ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
      background: linear-gradient(90deg, #fc6076, #ff9a44);
      border-radius: 3px;
    }
    p {
      margin-bottom: 15px;
    }
    .explanation {
      font-size: 0.85em;
      color: #444444;
      text-align: center;
      max-width: 800px;
      margin: 0 auto 30px;
      line-height: 1.5;
      /* ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ åŠ¹æœ */
      background: rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      padding: 20px;
      border-radius: 12px;
      /* Y2Ké¢¨ã®è–„ã„ãƒœãƒ¼ãƒ€ãƒ¼ */
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    }
    /* ãƒªã‚¹ãƒˆã‚¹ã‚¿ã‚¤ãƒ« */
    .explanation ul {
      list-style-type: none;
      margin: 15px 0;
      padding: 0;
      text-align: left;
      display: inline-block;
    }
    .explanation li {
      margin-bottom: 8px;
      position: relative;
      padding-left: 25px;
    }
    .explanation li:before {
      content: "âœ“";
      position: absolute;
      left: 0;
      color: #fc6076;
      font-weight: bold;
    }
    .guide-text {
      margin-top: 15px;
      font-weight: 500;
      color: #6a11cb;
    }
    /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼ */
    .section-header {
      margin-bottom: 15px;
      text-align: center;
      color: #6a11cb;
    }
    .section-header h3 {
      margin-bottom: 5px;
      font-size: 1.2rem;
    }
    .section-header p {
      margin: 0;
      font-size: 0.9rem;
      color: #555;
    }
    /* ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆ */
    .helper-text {
      font-size: 0.8rem;
      color: #666;
      margin-top: 4px;
      margin-bottom: 8px;
      font-style: italic;
    }
    /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®èª¬æ˜æ–‡ */
    .section-desc {
      font-size: 0.85rem;
      color: #555;
      margin-bottom: 15px;
      text-align: center;
    }
    /* ãƒãƒ£ãƒ¼ãƒˆèª¬æ˜ */
    .chart-desc {
      font-size: 0.85rem;
      color: #555;
      text-align: center;
      margin-bottom: 15px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      /* ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ åŠ¹æœ */
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      padding: 30px;
      /* Y2Ké¢¨ã®è–„ã„ãƒœãƒ¼ãƒ€ãƒ¼ */
      border: 1px solid rgba(255, 255, 255, 0.5);
      transition: all 0.3s ease;
    }

    /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    .input-section {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 20px;
      /* ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ åŠ¹æœ */
      background: rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      /* Y2Ké¢¨ã®è–„ã„ãƒœãƒ¼ãƒ€ãƒ¼ */
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    .input-group {
      display: flex;
      flex-direction: column;
      flex: 1 1 200px;
      position: relative;
    }
    label {
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 0.85rem;
      /* ãƒã‚ªãƒ³ã‚«ãƒ©ãƒ¼ã‚¿ãƒƒãƒã®ãƒ©ãƒ™ãƒ« */
      color: #6a11cb;
      letter-spacing: 0.5px;
    }
    input,
    select {
      padding: 12px;
      /* ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ åŠ¹æœã®ã‚¤ãƒ³ãƒ—ãƒƒãƒˆ */
      background: rgba(255, 255, 255, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.4);
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    input:focus,
    select:focus {
      border-color: #fc6076;
      outline: none;
      box-shadow: 0 0 0 3px rgba(252, 96, 118, 0.2);
    }
    button {
      cursor: pointer;
      padding: 12px 24px;
      /* Y2Ké¢¨ãƒã‚ªãƒ³ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
      background: linear-gradient(45deg, #fc6076 0%, #ff9a44 100%);
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(252, 96, 118, 0.3);
    }
    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(252, 96, 118, 0.4);
    }
    button:active {
      transform: translateY(-1px);
    }
    
    /* ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ãªãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆè¿½åŠ  */
    .button-hover {
      position: relative;
      overflow: hidden;
    }
    .button-hover:after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.2);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
    }
    .button-hover:hover:after {
      transform: translateX(0);
    }

    /* ç›®å®‰è¡¨ */
    .reference-table {
      font-size: 0.7em;
      color: #444444;
      margin-bottom: 0;
    }
    .reference-table table {
      width: 100%;
      border-collapse: collapse;
    }
    .reference-table th,
    .reference-table td {
      /* Y2Ké¢¨ã®æ˜ã‚‹ã„ãƒœãƒ¼ãƒ€ãƒ¼ */
      border: 1px solid rgba(252, 96, 118, 0.2);
      padding: 4px;
      text-align: center;
    }
    .reference-table th {
      /* Y2Ké¢¨ã®æ˜ã‚‹ã„èƒŒæ™¯ */
      background: rgba(252, 96, 118, 0.1);
    }

    /* å‡ºåŠ›ãƒ–ãƒ­ãƒƒã‚¯ï¼šç›®å®‰è¡¨ã¨å‡ºåŠ›çµæœ */
    .output-container {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
    }
    .reference-container {
      flex: 1;
      /* ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ åŠ¹æœ */
      background: rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      padding: 15px;
      border-radius: 12px;
      /* Y2Ké¢¨ã®è–„ã„ãƒœãƒ¼ãƒ€ãƒ¼ */
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    }

    /* kpiUnified: single container for KPI & Rank achievement */
    .kpiUnified {
      flex: 1;
      padding: 20px;
      /* ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ åŠ¹æœ */
      background: rgba(255, 255, 255, 0.5);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      /* Y2Ké¢¨ã®è–„ã„ãƒœãƒ¼ãƒ€ãƒ¼ */
      border: 1px solid rgba(255, 255, 255, 0.5);
      display: flex;
      flex-direction: column;
      gap: 25px;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    /* ã‚¿ã‚¤ãƒˆãƒ«è¿½åŠ  */
    .kpiUnified-title {
      text-align: center;
      font-size: 1.2rem;
      font-weight: 700;
      /* ãƒã‚ªãƒ³ã‚«ãƒ©ãƒ¼ */
      color: #6a11cb;
      margin-bottom: 5px;
      letter-spacing: 0.5px;
    }

    .kpiUnified-row {
      display: flex;
      gap: 30px;
      align-items: stretch;
      justify-content: space-around;
      flex-wrap: wrap;
    }
    .kpiUnified-col {
      flex: 1;
      min-width: 150px;
      max-width: 200px;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      /* ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ åŠ¹æœ */
      background: rgba(255, 255, 255, 0.5);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      border-radius: 12px;
      padding: 15px 10px;
      /* Y2Ké¢¨ã®è–„ã„ãƒœãƒ¼ãƒ€ãƒ¼ */
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .kpiUnified-col:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }
    /* é …ç›®åã¯å°ã•ã */
    .kpiUnified-col h3 {
      margin-bottom: 10px;
      font-size: 0.85rem;
      font-weight: 700;
      /* ãƒã‚ªãƒ³ã‚«ãƒ©ãƒ¼ */
      color: #6a11cb;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    /* æ•°å€¤ã¨ãƒ©ãƒ™ãƒ«ã‚’ç¸¦ã«é…ç½® */
    .kpiUnified-col p {
      margin: 0;
      line-height: 1.2;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .kpiUnified-col p strong {
      font-size: 2.8em;
      font-weight: 900;
      /* ãƒã‚ªãƒ³ã‚«ãƒ©ãƒ¼ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ */
      background: linear-gradient(45deg, #fc6076 0%, #ff9a44 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      transition: all 0.5s ease;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }
    /* å˜ä½ãƒ©ãƒ™ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .kpiUnified-col p span {
      font-size: 0.9em;
      margin-top: 5px;
      color: #666;
    }
    /* é”æˆæœˆã®(ï½ã‹æœˆå¾Œ)ã¯å°ã•ãã€å¤ªå­—ã§ã¯ãªã„ */
    .achieve-later {
      font-size: 0.7em !important;
      font-weight: normal;
      color: #333;
      margin-top: 5px;
      display: block;
    }
    
    /* ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚¹ã‚¿ã‚¤ãƒ« - é•·ã„ãƒ†ã‚­ã‚¹ãƒˆç”¨ */
    .text-tooltip {
      position: relative;
      cursor: help;
    }
    .text-tooltip:hover::after {
      content: attr(data-full-text);
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      /* ãƒã‚ªãƒ³ã‚«ãƒ©ãƒ¼ã®èƒŒæ™¯ */
      background: linear-gradient(45deg, rgba(106, 17, 203, 0.9), rgba(37, 117, 252, 0.9));
      color: white;
      padding: 8px 12px;
      border-radius: 8px;
      z-index: 100;
      font-size: 0.8rem;
      white-space: nowrap;
      margin-top: 5px;
      /* Y2Ké¢¨ã®è–„ã„ãƒœãƒ¼ãƒ€ãƒ¼ */
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      font-weight: normal;
    }

    /* ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ« */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      /* ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ åŠ¹æœ */
      background: rgba(255, 255, 255, 0.5);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      border-radius: 12px;
      overflow: hidden;
      /* Y2Ké¢¨ã®è–„ã„ãƒœãƒ¼ãƒ€ãƒ¼ */
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    }
    thead {
      /* Y2Ké¢¨ã®æ˜ã‚‹ã„èƒŒæ™¯ */
      background: linear-gradient(45deg, rgba(252, 96, 118, 0.1), rgba(255, 154, 68, 0.1));
    }
    th,
    td {
      /* Y2Ké¢¨ã®æ˜ã‚‹ã„ãƒœãƒ¼ãƒ€ãƒ¼ */
      border: 1px solid rgba(252, 96, 118, 0.1);
      padding: 10px;
      text-align: right;
      font-size: 0.9rem;
      transition: background 0.2s ease;
    }
    th {
      font-weight: 700;
      text-align: center;
      /* ãƒã‚ªãƒ³ã‚«ãƒ©ãƒ¼ */
      color: #6a11cb;
    }
    tbody tr.year-break {
      border-top: 3px solid #fc6076;
    }
    tbody tr:nth-child(even) {
      background: rgba(252, 96, 118, 0.05);
    }
    tbody tr:hover {
      background: rgba(252, 96, 118, 0.1);
    }

    /* ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ */
    .charts-wrapper {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      justify-content: space-between;
      margin-bottom: 30px;
    }
    .chart-container {
      flex: 1;
      min-width: 300px;
      max-width: 600px;
      /* ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ åŠ¹æœ */
      background: rgba(255, 255, 255, 0.5);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      padding: 20px;
      /* Y2Ké¢¨ã®è–„ã„ãƒœãƒ¼ãƒ€ãƒ¼ */
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
    }
    .chart-container:hover {
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
      transform: translateY(-5px);
    }
    .chart-container h2 {
      /* ãƒã‚ªãƒ³ã‚«ãƒ©ãƒ¼ */
      color: #6a11cb;
      text-align: center;
      margin-bottom: 15px;
      font-size: 1.2rem;
      /* Y2Ké¢¨ã®ãƒ†ã‚­ã‚¹ãƒˆåŠ¹æœ */
      letter-spacing: 1px;
    }
    canvas {
      width: 100% !important;
      height: auto !important;
    }

    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
    @media (max-width: 1024px) {
      .charts-wrapper {
        flex-direction: column;
      }
      .chart-container {
        max-width: 100%;
      }
    }
    
    @media (max-width: 768px) {
      .input-section,
      .output-container {
        flex-direction: column;
      }
      
      .reference-container, 
      .kpi-accordion-container {
        width: 100%;
        margin-bottom: 20px;
      }
      
      .accordion-container {
        grid-template-columns: 1fr 1fr;
      }
      
      /* ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œ */
      #kpiTable {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
        max-width: 100%;
        -webkit-overflow-scrolling: touch;
      }
    }
    
    @media (max-width: 480px) {
      .accordion-container {
        grid-template-columns: 1fr;
      }
      
      .accordion-card {
        min-width: 100%;
      }
      
      .number-selector {
        width: calc(100% - 25px); /* ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚¢ã‚¤ã‚³ãƒ³åˆ†ã®ä½™ç™½ */
      }
      
      .container {
        padding: 15px;
      }
      
      h1 {
        font-size: 1.8rem;
      }
    }

    /* ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ */
    .export-container {
      display: flex;
      justify-content: flex-end;
      margin-top: 10px;
      gap: 10px;
    }
    .export-btn {
      display: inline-flex;
      align-items: center;
      padding: 10px 18px;
      /* Y2Ké¢¨ãƒã‚ªãƒ³ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
      background: linear-gradient(45deg, #fc6076 0%, #ff9a44 100%);
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(252, 96, 118, 0.3);
    }
    .export-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(252, 96, 118, 0.4);
    }
    .export-btn:active {
      transform: translateY(-1px);
    }
    .export-btn svg {
      margin-right: 8px;
      width: 16px;
      height: 16px;
    }

    /* ã‚·ãƒŠãƒªã‚ªä¿å­˜æ©Ÿèƒ½ */
    .scenario-container {
      margin-top: 20px;
      padding: 20px;
      /* ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ åŠ¹æœ */
      background: rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      border-radius: 12px;
      /* Y2Ké¢¨ã®è–„ã„ãƒœãƒ¼ãƒ€ãƒ¼ */
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    }
    .scenario-title {
      font-weight: 700;
      margin-bottom: 10px;
      /* ãƒã‚ªãƒ³ã‚«ãƒ©ãƒ¼ */
      color: #6a11cb;
      font-size: 1.2rem;
      /* Y2Ké¢¨ã®ãƒ†ã‚­ã‚¹ãƒˆåŠ¹æœ */
      letter-spacing: 1px;
    }
    .scenario-description {
      font-size: 0.85em;
      color: #444444;
      text-align: center;
      max-width: 800px;
      margin: 0 auto 20px;
      line-height: 1.5;
    }
    .scenario-form {
      display: flex;
      gap: 10px;
      align-items: flex-end;
      margin-bottom: 15px;
    }
    .scenario-list {
      margin-top: 15px;
      max-height: 200px;
      overflow-y: auto;
      /* ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ åŠ¹æœ */
      background: rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      border-radius: 8px;
      /* Y2Ké¢¨ã®è–„ã„ãƒœãƒ¼ãƒ€ãƒ¼ */
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .scenario-item {
      padding: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .scenario-item:last-child {
      border-bottom: none;
    }
    .scenario-item:hover {
      background: rgba(252, 96, 118, 0.1);
    }
    .scenario-actions {
      display: flex;
      gap: 8px;
    }
    .scenario-btn {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.8rem;
      font-weight: 600;
      /* Y2Ké¢¨ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ (è–„ã‚) */
      background: linear-gradient(45deg, rgba(252, 96, 118, 0.7) 0%, rgba(255, 154, 68, 0.7) 100%);
      color: white;
      transition: all 0.2s ease;
    }
    .scenario-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(252, 96, 118, 0.3);
    }
    .scenario-btn.delete {
      background: linear-gradient(45deg, rgba(255, 76, 76, 0.7), rgba(255, 123, 123, 0.7));
    }
    .scenario-btn.delete:hover {
      background: linear-gradient(45deg, rgba(255, 76, 76, 0.9), rgba(255, 123, 123, 0.9));
    }

    /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .slider-container {
      margin-top: 5px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .slider {
      flex: 1;
      height: 6px;
      -webkit-appearance: none;
      appearance: none;
      /* Y2Ké¢¨ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ãƒˆãƒ©ãƒƒã‚¯ */
      background: linear-gradient(90deg, rgba(252, 96, 118, 0.3), rgba(255, 154, 68, 0.3));
      outline: none;
      border-radius: 5px;
      transition: all 0.3s;
    }
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      /* Y2Ké¢¨ã®ãƒã‚ªãƒ³ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã¤ã¾ã¿ */
      background: linear-gradient(135deg, #fc6076, #ff9a44);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(252, 96, 118, 0.4);
      transition: all 0.3s;
    }
    .slider::-webkit-slider-thumb:hover {
      transform: scale(1.3);
      box-shadow: 0 4px 12px rgba(252, 96, 118, 0.6);
    }
    .slider-value {
      min-width: 60px;
      font-size: 0.85rem;
      padding: 4px 8px;
      border-radius: 6px;
      /* ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ åŠ¹æœ */
      background: rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      /* Y2Ké¢¨ã®è–„ã„ãƒœãƒ¼ãƒ€ãƒ¼ */
      border: 1px solid rgba(255, 255, 255, 0.3);
      text-align: center;
    }

    /* æ•°å€¤ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .number-selector {
      display: flex;
      align-items: center;
      /* ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ åŠ¹æœ */
      background: rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      /* Y2Ké¢¨ã®è–„ã„ãƒœãƒ¼ãƒ€ãƒ¼ */
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      overflow: hidden;
      width: 100%;
      position: relative;
    }
    .number-selector input {
      border: none;
      box-shadow: none;
      text-align: center;
      flex: 1;
      padding: 10px 0;
      width: 60px;
      background: transparent;
    }
    .number-selector input:focus {
      box-shadow: none;
    }
    .number-btn {
      /* Y2Ké¢¨ãƒã‚ªãƒ³ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
      background: linear-gradient(45deg, #fc6076 0%, #ff9a44 100%);
      border: none;
      padding: 10px 15px;
      cursor: pointer;
      color: white;
      font-weight: bold;
      transition: all 0.3s;
    }
    .number-btn:hover {
      background: linear-gradient(45deg, #ff7a98 0%, #ffb76f 100%);
    }
    /* ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚¢ã‚¤ã‚³ãƒ³ã®ä½ç½®èª¿æ•´ */
    .input-group .tooltip-icon {
      right: -25px;
      top: 10px;
    }
    .input-group .number-selector + .tooltip-icon {
      right: -25px;
      top: 10px;
    }

    /* ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®æ”¹å–„ */
    .kpi-accordion-container {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .accordion-section-title {
      font-size: 1.2rem;
      font-weight: 700;
      /* ãƒã‚ªãƒ³ã‚«ãƒ©ãƒ¼ */
      color: #6a11cb;
      margin-bottom: 15px;
      text-align: center;
      /* Y2Ké¢¨ã®ãƒ†ã‚­ã‚¹ãƒˆåŠ¹æœ */
      letter-spacing: 1px;
    }
    .accordion-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: auto auto;
      gap: 15px;
      margin-bottom: 10px;
    }
    .accordion-row {
      display: contents;
    }
    .accordion-card {
      position: relative;
      padding: 15px;
      /* ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ åŠ¹æœ */
      background: rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      border-radius: 12px;
      /* Y2Ké¢¨ã®è–„ã„ãƒœãƒ¼ãƒ€ãƒ¼ */
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
      overflow: hidden;
      cursor: pointer;
      flex: 1;
      min-width: 140px;
    }
    .accordion-card:hover {
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
      transform: translateY(-5px);
    }
    .accordion-card::after {
      content: "ï¼‹";
      position: absolute;
      top: 10px;
      right: 12px;
      /* ãƒã‚ªãƒ³ã‚«ãƒ©ãƒ¼ */
      color: #6a11cb;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      /* Y2Ké¢¨ã®æ˜ã‚‹ã„èƒŒæ™¯ */
      background: rgba(252, 96, 118, 0.1);
      border-radius: 50%;
    }
    .accordion-card.expanded::after {
      content: "âˆ’";
      background: rgba(252, 96, 118, 0.2);
    }
    .accordion-title {
      font-size: 0.9rem;
      font-weight: 700;
      /* ãƒã‚ªãƒ³ã‚«ãƒ©ãƒ¼ */
      color: #6a11cb;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
      padding-right: 25px;
    }
    .accordion-value {
      font-size: 2.2em;
      font-weight: 900;
      /* ãƒã‚ªãƒ³ã‚«ãƒ©ãƒ¼ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ */
      background: linear-gradient(45deg, #fc6076 0%, #ff9a44 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin: 0;
      padding-right: 20px;
      display: flex;
      align-items: baseline;
    }
    .accordion-value .unit {
      font-size: 0.5em;
      margin-left: 5px;
      color: #666;
      font-weight: 500;
      /* ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¸Šæ›¸ã */
      background: none;
      -webkit-background-clip: initial;
      -webkit-text-fill-color: #666;
    }
    .accordion-details {
      height: 0;
      overflow: hidden;
      transition: height 0.3s ease;
      margin-top: 5px;
    }
    .accordion-card.expanded .accordion-details {
      height: auto;
      padding-top: 10px;
      border-top: 1px solid rgba(252, 96, 118, 0.2);
    }
    .accordion-details-content {
      font-size: 0.85rem;
      line-height: 1.4;
      color: #555;
    }
    
    /* ãƒ†ãƒ¼ãƒ–ãƒ«æ³¨é‡ˆ */
    .table-note {
      margin-bottom: 15px;
      padding: 12px;
      /* ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ åŠ¹æœ */
      background: rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      border-radius: 8px;
      /* Y2Ké¢¨ã®è–„ã„ãƒœãƒ¼ãƒ€ãƒ¼ */
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    .table-note p {
      margin: 0;
      font-size: 0.85rem;
      color: #555;
    }
    
    /* Y2Ké¢¨ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœ - ç”»é¢è£…é£¾ç”¨ */
    .particle-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
      overflow: hidden;
    }
    .particle {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: linear-gradient(45deg, rgba(252, 96, 118, 0.6), rgba(255, 154, 68, 0.6));
      animation: float 15s infinite linear;
    }
    @keyframes float {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 0.8;
      }
      90% {
        opacity: 0.8;
      }
      100% {
        transform: translateY(-100vh) rotate(360deg);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <div class="particle-container"></div>
  <div class="container">
    <h1>ãƒ‰ãƒ†ãƒ©ç›®æ¨™é”æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h1>
    <div class="explanation">
      <h3>ğŸ‘‡ ã“ã®ãƒ„ãƒ¼ãƒ«ã§ã§ãã‚‹ã“ã¨</h3>
      <ul>
        <li>ä»Šå¾Œ24ãƒ¶æœˆé–“ã®ãƒ‰ãƒ†ãƒ©ãƒ“ã‚¸ãƒã‚¹æˆé•·ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</li>
        <li>ç›®æ¨™ã®PVé”æˆæ™‚æœŸã‚’äºˆæ¸¬</li>
        <li>å¿…è¦ãªæ–°è¦ç™»éŒ²è€…æ•°ã‚„è‚²æˆãƒ“ãƒ«ãƒ€ãƒ¼æ•°ã‚’è¨ˆç®—</li>
      </ul>
      <p class="guide-text">ä¸‹è¨˜ã®å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã«å¿…è¦äº‹é …ã‚’å…¥åŠ›ã™ã‚‹ã ã‘ã§ã€ã‚ãªãŸã®ãƒ‰ãƒ†ãƒ©ãƒ“ã‚¸ãƒã‚¹ã®ç›®æ¨™é”æˆæ™‚æœŸã‚’è‡ªå‹•äºˆæ¸¬ã—ã¾ã™ã€‚</p>
    </div>

    <!-- å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="input-section">
      <div class="section-header">
        <h3>ğŸ“ åŸºæœ¬æƒ…å ±ã®å…¥åŠ›</h3>
        <p>ç¾åœ¨ã®çŠ¶æ³ã¨ç›®æ¨™ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
      </div>
      <div class="input-group">
        <label for="currentPV">ç¾åœ¨ã® PV</label>
        <input type="number" id="currentPV" value="3000" min="0" />
        <div class="slider-container">
          <input type="range" id="currentPVSlider" min="0" max="50000" step="500" value="3000" class="slider">
          <div class="slider-value">3000</div>
        </div>
      </div>
      <div class="input-group">
        <label for="yearGoal">ä»Šå¹´ã®ç›®æ¨™ Rank</label>
        <select id="yearGoal">
          <option value="EXECUTIVE">EXECUTIVE</option>
          <option value="ELITE">ELITE</option>
          <option value="PREMIERE">PREMIERE</option>
          <option value="SILVER" selected>SILVER</option>
          <option value="GOLD">GOLD</option>
          <option value="PLATINUM">PLATINUM</option>
          <option value="DIAMOND">DIAMOND</option>
          <option value="BLUE DIAMOND">BLUE DIAMOND</option>
          <option value="PRESIDENTIAL">PRESIDENTIAL</option>
        </select>
      </div>
      <div class="input-group">
        <label for="goalPV">ç›®æ¨™ PV</label>
        <input type="number" id="goalPV" value="9000" min="0" />
        <div class="slider-container">
          <input type="range" id="goalPVSlider" min="0" max="200000" step="1000" value="9000" class="slider">
          <div class="slider-value">9000</div>
        </div>
      </div>
      <div class="input-group">
        <label for="monthlyTarget">æ–°è¦ç™»éŒ²è€…ç›®æ¨™æ•°(æœˆå¹³å‡)</label>
        <div class="number-selector">
          <button class="number-btn decrease button-hover">âˆ’</button>
          <input type="number" id="monthlyTarget" value="7" step="1" min="0" max="1000" />
          <button class="number-btn increase button-hover">ï¼‹</button>
        </div>
      </div>
      <div class="input-group">
        <label for="targetDate">ç›®æ¨™è¨­å®šæ—¥</label>
        <input type="date" id="targetDate" value="2025-01-01" />
      </div>
    </div>

    <!-- å‡ºåŠ›ãƒ–ãƒ­ãƒƒã‚¯ï¼š ç›®å®‰è¡¨ + KPI&ç›®æ¨™Ranké”æˆ -->
    <div class="output-container">
      <div class="reference-container">
        <h3 class="section-header">ğŸ“Š ãƒ©ãƒ³ã‚¯åˆ¥ç›®æ¨™å€¤ ç›®å®‰è¡¨</h3>
        <p class="section-desc">å„ãƒ©ãƒ³ã‚¯é”æˆã«å¿…è¦ãªPVã¨ç™»éŒ²è€…æ•°ã€ãŠã‚ˆã³ãŠãŠã‚ˆãã®åå…¥ç›®å®‰</p>
        <table class="reference-table">
          <thead>
            <tr>
              <th>Rank</th>
              <th>PV</th>
              <th>ç™»éŒ²è€…</th>
              <th>ç›®å®‰æœˆå$</th>
              <th>ç›®å®‰æœˆåÂ¥</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>EXECUTIVE</td>
              <td>2,000</td>
              <td>13</td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>ELITE</td>
              <td>3,000</td>
              <td>20</td>
              <td>$300</td>
              <td>Â¥39,000</td>
            </tr>
            <tr>
              <td>PREMIERE</td>
              <td>5,000</td>
              <td>27</td>
              <td>$600</td>
              <td>Â¥78,000</td>
            </tr>
            <tr>
              <td>SILVER</td>
              <td>9,000</td>
              <td>60</td>
              <td>$2,125</td>
              <td>Â¥276,250</td>
            </tr>
            <tr>
              <td>GOLD</td>
              <td>12,000</td>
              <td>80</td>
              <td>$4,667</td>
              <td>Â¥606,710</td>
            </tr>
            <tr>
              <td>PLATINUM</td>
              <td>27,000</td>
              <td>180</td>
              <td>$8,750</td>
              <td>Â¥1,137,500</td>
            </tr>
            <tr>
              <td>DIAMOND</td>
              <td>36,000</td>
              <td>240</td>
              <td>$10,683</td>
              <td>Â¥1,388,790</td>
            </tr>
            <tr>
              <td>BLUE DIAMOND</td>
              <td>60,000</td>
              <td>400</td>
              <td>$36,500</td>
              <td>Â¥4,745,000</td>
            </tr>
            <tr>
              <td>PRESIDENTIAL</td>
              <td>162,000</td>
              <td>1,080</td>
              <td>$106,833</td>
              <td>Â¥13,888,290</td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <!-- æ–°ã—ã„ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³å¼ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
      <div class="kpi-accordion-container">
        <h3 class="accordion-section-title">âœ¨ ã‚ãªãŸã®ç›®æ¨™é”æˆã«å‘ã‘ãŸäºˆæ¸¬</h3>
        <p class="section-desc">å…¥åŠ›æƒ…å ±ã‚’ã‚‚ã¨ã«è¨ˆç®—ã•ã‚ŒãŸé‡è¦æŒ‡æ¨™</p>
        <div class="accordion-container" id="kpiAccordionContainer">
          <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
        </div>
      </div>
    </div>

    <!-- ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
    <div class="charts-wrapper">
      <div class="chart-container">
        <h2>1å¹´äºˆæ¸¬ã‚°ãƒ©ãƒ•</h2>
        <p class="chart-desc">æœ€åˆã®12ãƒ¶æœˆé–“ã®ç™»éŒ²è€…æ•°ã¨ç´¯ç©PVäºˆæ¸¬</p>
        <canvas id="chartYear1"></canvas>
      </div>
      <div class="chart-container">
        <h2>2å¹´äºˆæ¸¬ã‚°ãƒ©ãƒ•</h2>
        <p class="chart-desc">13ãƒ¶æœˆç›®ã‹ã‚‰24ãƒ¶æœˆç›®ã®ç™»éŒ²è€…æ•°ã¨ç´¯ç©PVäºˆæ¸¬</p>
        <canvas id="chartYear2"></canvas>
      </div>
    </div>

    <!-- KPI ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆ24ã‚«æœˆåˆ†ï¼‰ -->
    <h2>ğŸ’¹ KPI ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ (æœˆæ¬¡è©³ç´°)</h2>
    <div class="table-note">
      <p><strong>LRPç¶™ç¶šç‡ï¼š80%</strong> - æ–°è¦ç™»éŒ²è€…ã®80%ãŒLRPï¼ˆãƒ­ã‚¤ãƒ¤ãƒ«ãƒ†ã‚£ãƒ»ãƒªãƒ¯ãƒ¼ãƒ‰ãƒ»ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼‰ã‚’ç¶™ç¶šã™ã‚‹ã¨æƒ³å®šã—ã¦ã„ã¾ã™ã€‚ã“ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯æ¯æœˆã®æ–°è¦ç™»éŒ²è€…ã®80%ãŒLRPã«ç¶™ç¶šã™ã‚‹å‰æã§è¨ˆç®—ã—ã¦ã„ã¾ã™ã€‚</p>
      <p><strong>PVäºˆæ¸¬ï¼ˆOVï¼‰</strong> - è¨ˆç®—å¼ï¼šç¾åœ¨ã®PV + (æœˆæ•° Ã— æ–°è¦ç™»éŒ²è€…æ•° Ã— 150ãƒã‚¤ãƒ³ãƒˆ)</p>
    </div>
    <table id="kpiTable">
      <thead>
        <tr>
          <th>æœˆ</th>
          <th>ã‚µãƒ³ãƒ—ãƒ«é…å¸ƒæ•°</th>
          <th>è¬›åº§å‚åŠ æ•°</th>
          <th>æ–°è¦ç™»éŒ²è€…æ•°</th>
          <th>LRPç¶™ç¶šè€…æ•°</th>
          <th>Useræ•°</th>
          <th>ã‚·ã‚§ã‚¢ãƒ©ãƒ¼</th>
          <th>ãƒ“ãƒ«ãƒ€ãƒ¼è‚²æˆæ•°</th>
          <th>OV (PVäºˆæ¸¬)</th>
        </tr>
      </thead>
      <tbody>
        <!-- ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã¯ JavaScript ã§ç”Ÿæˆ -->
      </tbody>
    </table>

    <!-- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ -->
    <div class="export-container">
      <button id="exportBtn" class="export-btn button-hover">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        CSVã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
      </button>
    </div>

    <!-- ã‚·ãƒŠãƒªã‚ªä¿å­˜æ©Ÿèƒ½ -->
    <div class="scenario-container">
      <div class="scenario-title">ğŸ’¾ ã‚·ãƒŠãƒªã‚ªä¿å­˜</div>
      <p class="scenario-description">
        ç¾åœ¨ã®è¨­å®šã‚’åå‰ã‚’ä»˜ã‘ã¦ä¿å­˜ã—ã¾ã™ã€‚ä¿å­˜ã—ãŸã‚·ãƒŠãƒªã‚ªã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«è¨˜éŒ²ã•ã‚Œã€
        ã“ã®ãƒ‡ãƒã‚¤ã‚¹ã¨ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®ã¿åˆ©ç”¨ã§ãã¾ã™ã€‚ç•°ãªã‚‹ç›®æ¨™è¨­å®šã‚’è©¦ã—ã€æ¯”è¼ƒã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
      </p>
      <div class="scenario-form">
        <input type="text" id="scenarioName" placeholder="ã‚·ãƒŠãƒªã‚ªåã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šSILVERç›®æ¨™2025å¹´ï¼‰">
        <button id="saveScenarioBtn" class="button-hover">ã‚·ãƒŠãƒªã‚ªä¿å­˜</button>
      </div>
      <div class="scenario-list">
        <!-- ã‚·ãƒŠãƒªã‚ªãƒªã‚¹ãƒˆã¯ JavaScript ã§ç”Ÿæˆ -->
      </div>
    </div>
  </div>

  <script>
    /************************************************
     * ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯:
     * LRPç¶™ç¶šè€…æ•°ã¯æ¯æœˆç´¯ç©
     * User = ç´¯ç© LRP
     * ã‚·ã‚§ã‚¢ãƒ©ãƒ¼ = 50% of User (ãã®æœˆæ™‚ç‚¹), ç´¯ç©ã—ãªã„
     * ãƒ“ãƒ«ãƒ€ãƒ¼è‚²æˆæ•° = 20% of ã‚·ã‚§ã‚¢ãƒ©ãƒ¼(ãã®æœˆ), ç´¯ç©ã—ãªã„
     * OV = currentPV + (æœˆæ•° Ã— newReg Ã— 150)
     *   åˆæœˆ m=0 => currentPV + (newReg * 150)
     *   2ãƒ¶æœˆç›® => currentPV + (2* newReg * 150)
     *   ...
     ************************************************/

    function recalcKpiData() {
      const newRegInput = parseFloat(document.getElementById("monthlyTarget").value)||7;
      const newReg = Math.floor(newRegInput);

      let currentPV = parseFloat(document.getElementById("currentPV").value);
      if(isNaN(currentPV)) currentPV=3000;

      const targetDateStr = document.getElementById("targetDate").value;
      let startDate = targetDateStr ? new Date(targetDateStr): new Date();

      // ã‚µãƒ³ãƒ—ãƒ«é…å¸ƒæ•° = floor(newReg*(30/11))
      // è¬›åº§å‚åŠ æ•°     = floor(newReg*(21/11))
      // æ–°è¦ç™»éŒ²è€…æ•°   = newReg
      // LRPç¶™ç¶šç‡80% => LRP= floor(newReg*0.8) (æœˆã”ã¨è¿½åŠ )

      const sampleEach = Math.floor(newReg*(30/11));
      const lectureEach= Math.floor(newReg*(21/11));
      const lrpEach   = Math.floor(newReg*0.8);

      // OV multiplier
      const ovMultiplier=150;

      let simData=[];

      // ç´¯ç©LRP
      let cumLRP=0;
      let prevYear;

      for(let m=0; m<24; m++) {
        let simDate = new Date(
          startDate.getFullYear(),
          startDate.getMonth()+m,
          startDate.getDate()
        );
        let newYearBreak=false;
        if(m===0) {
          prevYear=simDate.getFullYear();
        } else {
          if(simDate.getFullYear()!==prevYear){
            newYearBreak=true;
            prevYear=simDate.getFullYear();
          }
        }

        // LRPç´¯ç©
        if(m>0) {
          cumLRP += lrpEach;
        } else {
          // åˆæœˆ
          cumLRP= lrpEach;
        }

        // user= cumLRP
        // sharer= floor(user*0.5)
        // builder= floor(sharer*0.2)
        const user = cumLRP;
        const sharer= Math.floor(user*0.5);
        const builder= Math.floor(sharer*0.2);

        // OV
        // m=0 => currentPV + newReg*150
        // m>0 => currentPV + ( (m+1)* newReg *150 )
        let OV;
        if(m===0) {
          OV= currentPV + newReg*ovMultiplier;
        } else {
          OV= currentPV + ( (m+1)* newReg* ovMultiplier );
        }
        let OVFormatted= OV.toLocaleString();

        let monthLabel= simDate.getFullYear()+"å¹´"+(simDate.getMonth()+1)+"æœˆ";

        simData.push({
          monthLabel,
          sample: sampleEach,
          lecture: lectureEach,
          newReg,
          lrp: cumLRP,
          user: cumLRP,
          sharer,
          builder,
          OV: OVFormatted,
          newYearBreak
        });
      }
      return simData;
    }

    // KPIå‡ºåŠ›
    function updateKpiResults(){
      const simData = recalcKpiData();

      const newRegInput = parseFloat(document.getElementById("monthlyTarget").value)||7;
      const newReg = Math.floor(newRegInput);

      // 12ã‹æœˆå¾Œã®ãƒ“ãƒ«ãƒ€ãƒ¼è‚²æˆæ•° => simData[11].builder
      //  (ãŸã ã—ã€é…åˆ—ãŒ0-basedãªã®ã§12ã‹æœˆç›®ã¯ index=11 )
      let builderAt12 = 0;
      if(simData.length >= 12){
        builderAt12 = simData[11].builder;
      }

      // å¹´æ›ç®— æ–°è¦ç™»éŒ²è€…
      const annualNew = newReg*12;

      // ç›®æ¨™é”æˆ
      const goalPV = parseFloat(document.getElementById("goalPV").value)||9000;
      let achieveMonthLine1 = "æœªé”";
      let achieveMonthLine2 = "";

      for(let i=0; i<simData.length; i++) {
        const ovNum = parseInt(simData[i].OV.replace(/,/g,""));
        if(ovNum>=goalPV){
          achieveMonthLine1 = simData[i].monthLabel;
          achieveMonthLine2 = `(${i+1}ã‚«æœˆå¾Œ)`;
          break;
        }
      }

      // ç›®æ¨™Rank
      const goalRank = document.getElementById("yearGoal").value;
      
      // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã‚³ãƒ³ãƒ†ãƒŠã‚’å–å¾—
      const accordionContainer = document.getElementById("kpiAccordionContainer");
      
      // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
      accordionContainer.innerHTML = `
        <!-- ä¸Šæ®µï¼šæ–°è¦ç™»éŒ²è€…ã¨ãƒ“ãƒ«ãƒ€ãƒ¼è‚²æˆæ•° -->
        <div class="accordion-row">
          <!-- æ–°è¦ç™»éŒ²è€…ã‚«ãƒ¼ãƒ‰ -->
          <div class="accordion-card" id="newRegCard">
            <div class="accordion-title">æ–°è¦ç™»éŒ²è€…</div>
            <div class="accordion-value">${annualNew}<span class="unit">å/å¹´</span></div>
            <div class="accordion-details">
              <div class="accordion-details-content">
                æœˆé–“å¹³å‡${newReg}åã®æ–°è¦ç™»éŒ²è€…ã‚’æƒ³å®šã€‚<br>
                å¹´é–“${annualNew}åã®æ–°è¦ç™»éŒ²ã‚’è¦‹è¾¼ã‚“ã§ã„ã¾ã™ã€‚
              </div>
            </div>
          </div>
          
          <!-- ãƒ“ãƒ«ãƒ€ãƒ¼è‚²æˆæ•°ã‚«ãƒ¼ãƒ‰ -->
          <div class="accordion-card" id="builderCard">
            <div class="accordion-title">ãƒ“ãƒ«ãƒ€ãƒ¼è‚²æˆæ•°</div>
            <div class="accordion-value">${builderAt12}<span class="unit">å/å¹´</span></div>
            <div class="accordion-details">
              <div class="accordion-details-content">
                12ãƒ¶æœˆå¾Œã®æ™‚ç‚¹ã§${builderAt12}åã®ãƒ“ãƒ«ãƒ€ãƒ¼ãŒè‚²æˆã•ã‚Œã‚‹è¦‹è¾¼ã¿ã§ã™ã€‚<br>
                ãƒ“ãƒ«ãƒ€ãƒ¼è‚²æˆæ•°ã¯ã‚·ã‚§ã‚¢ãƒ©ãƒ¼ã®20%ã¨æƒ³å®šã—ã¦ã„ã¾ã™ã€‚
              </div>
            </div>
          </div>
        </div>
        
        <!-- ä¸‹æ®µï¼šç›®æ¨™Rankã¨é”æˆæœˆ -->
        <div class="accordion-row">
          <!-- ç›®æ¨™Rankã‚«ãƒ¼ãƒ‰ -->
          <div class="accordion-card" id="goalRankCard">
            <div class="accordion-title">ç›®æ¨™Rank</div>
            <div class="accordion-value">${goalRank}</div>
            <div class="accordion-details">
              <div class="accordion-details-content">
                ${goalRank}ãƒ©ãƒ³ã‚¯ã®é”æˆæ¡ä»¶ï¼š<br>
                ${getRankDetails(goalRank)}
              </div>
            </div>
          </div>
          
          <!-- é”æˆæœˆã‚«ãƒ¼ãƒ‰ -->
          <div class="accordion-card" id="achieveMonthCard">
            <div class="accordion-title">é”æˆæœˆ</div>
            <div class="accordion-value">${achieveMonthLine1 === "æœªé”" ? "æœªé”" : achieveMonthLine1}</div>
            <div class="accordion-details">
              <div class="accordion-details-content">
                ${
                  achieveMonthLine1 === "æœªé”" ? 
                  "ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æœŸé–“(24ãƒ¶æœˆ)å†…ã§ã¯ç›®æ¨™é”æˆã§ãã¾ã›ã‚“ã€‚<br>ã•ã‚‰ã«é•·æœŸã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¿…è¦ã§ã™ã€‚" : 
                  `ç›®æ¨™é”æˆã¾ã§${achieveMonthLine2.replace(/[()]/g, '')}ã‹ã‹ã‚‹è¦‹è¾¼ã¿ã§ã™ã€‚<br>ç¾åœ¨ã®PVã‹ã‚‰æ¯æœˆã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœã«åŸºã¥ã„ã¦ç®—å‡ºã•ã‚Œã¦ã„ã¾ã™ã€‚`
                }
              </div>
            </div>
          </div>
        </div>
      `;
      
      // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã®å‹•ä½œè¨­å®š
      setupAccordion();
    }
    
    // Rankè©³ç´°æƒ…å ±ã‚’å–å¾—ã™ã‚‹é–¢æ•°
    function getRankDetails(rank) {
      const rankDetails = {
        "EXECUTIVE": "â€¢ å¿…è¦PV: 2,000<br>â€¢ ç›®å®‰ç™»éŒ²è€…æ•°: 13å",
        "ELITE": "â€¢ å¿…è¦PV: 3,000<br>â€¢ ç›®å®‰ç™»éŒ²è€…æ•°: 20å<br>â€¢ ç›®å®‰æœˆå: $300 (Â¥39,000)",
        "PREMIERE": "â€¢ å¿…è¦PV: 5,000<br>â€¢ ç›®å®‰ç™»éŒ²è€…æ•°: 27å<br>â€¢ ç›®å®‰æœˆå: $600 (Â¥78,000)",
        "SILVER": "â€¢ å¿…è¦PV: 9,000<br>â€¢ ç›®å®‰ç™»éŒ²è€…æ•°: 60å<br>â€¢ ç›®å®‰æœˆå: $2,125 (Â¥276,250)",
        "GOLD": "â€¢ å¿…è¦PV: 12,000<br>â€¢ ç›®å®‰ç™»éŒ²è€…æ•°: 80å<br>â€¢ ç›®å®‰æœˆå: $4,667 (Â¥606,710)",
        "PLATINUM": "â€¢ å¿…è¦PV: 27,000<br>â€¢ ç›®å®‰ç™»éŒ²è€…æ•°: 180å<br>â€¢ ç›®å®‰æœˆå: $8,750 (Â¥1,137,500)",
        "DIAMOND": "â€¢ å¿…è¦PV: 36,000<br>â€¢ ç›®å®‰ç™»éŒ²è€…æ•°: 240å<br>â€¢ ç›®å®‰æœˆå: $10,683 (Â¥1,388,790)",
        "BLUE DIAMOND": "â€¢ å¿…è¦PV: 60,000<br>â€¢ ç›®å®‰ç™»éŒ²è€…æ•°: 400å<br>â€¢ ç›®å®‰æœˆå: $36,500 (Â¥4,745,000)",
        "PRESIDENTIAL": "â€¢ å¿…è¦PV: 162,000<br>â€¢ ç›®å®‰ç™»éŒ²è€…æ•°: 1,080å<br>â€¢ ç›®å®‰æœˆå: $106,833 (Â¥13,888,290)"
      };
      
      return rankDetails[rank] || "è©³ç´°æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“";
    }
    
    // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã®å‹•ä½œã‚’è¨­å®šã™ã‚‹é–¢æ•°
    function setupAccordion() {
      const accordionCards = document.querySelectorAll('.accordion-card');
      accordionCards.forEach(card => {
        // æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤ï¼ˆé‡è¤‡ã‚’é˜²ããŸã‚ï¼‰
        card.removeEventListener('click', handleAccordionClick);
        // æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
        card.addEventListener('click', handleAccordionClick);
      });
    }
    
    // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼
    function handleAccordionClick() {
      this.classList.toggle('expanded');
      const details = this.querySelector('.accordion-details');
      
      if (this.classList.contains('expanded')) {
        details.style.height = details.scrollHeight + 'px';
      } else {
        details.style.height = '0';
      }
    }

    function onUpdate(){
      // æ›´æ–°æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ
      const accordionContainer = document.getElementById("kpiAccordionContainer");
      accordionContainer.style.opacity = "0.5";
      accordionContainer.style.transform = "translateY(10px)";
      
      setTimeout(() => {
        updateKpiResults();
        const simData = recalcKpiData();
        populateKpiTable(simData);
        renderCharts(simData);
        
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†
        accordionContainer.style.opacity = "1";
        accordionContainer.style.transform = "translateY(0)";
      }, 300);
    }

    // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«
    function populateKpiTable(simData){
      const tbody= document.getElementById("kpiTable").querySelector("tbody");
      tbody.innerHTML= "";
      simData.forEach(row=>{
        const tr= document.createElement("tr");
        if(row.newYearBreak){
          tr.classList.add("year-break");
        }
        let cells = [
          row.monthLabel,
          row.sample,
          row.lecture,
          row.newReg,
          row.lrp,
          row.user,
          row.sharer,
          row.builder,
          row.OV
        ];
        cells.forEach(cell=>{
          const td= document.createElement("td");
          td.textContent= cell;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }

    // ã‚°ãƒ©ãƒ•
    let chart1, chart2;
    function renderCharts(simData){
      Chart.register(window["chartjs-plugin-annotation"]);
      if(chart1) chart1.destroy();
      if(chart2) chart2.destroy();

      const goalPV= parseFloat(document.getElementById("goalPV").value)||9000;

      // 1å¹´
      const dataYear1= simData.slice(0,12);
      const labelsYear1= dataYear1.map((row,i)=>{
        if(i===0||row.newYearBreak){
          return row.monthLabel;
        } else {
          return row.monthLabel.split("å¹´")[1];
        }
      });
      const newRegYear1= dataYear1.map(r=> parseInt(r.newReg||0));
      const lrpYear1= dataYear1.map(r=> parseInt(r.lrp||0));
      const OVYear1= dataYear1.map(r=> parseInt(r.OV.replace(/,/g,"")));

      let achieveIndexYear1= -1;
      for(let i=0; i<OVYear1.length; i++){
        if(OVYear1[i]>= goalPV){
          achieveIndexYear1= i;
          break;
        }
      }

      const achieveBorderColor= "rgba(252, 96, 118, 0.8)";
      const achieveBgColor= "rgba(252, 96, 118, 0.2)";

      const ctx1= document.getElementById("chartYear1").getContext("2d");
      chart1= new Chart(ctx1, {
        type: "bar",
        data: {
          labels: labelsYear1,
          datasets: [
            {
              label:"æ–°è¦ç™»éŒ²è€…æ•°",
              data:newRegYear1,
              backgroundColor:"rgba(252, 96, 118, 0.7)",
              stack:"stack1"
            },
            {
              label:"LRPç¶™ç¶šè€…æ•°",
              data:lrpYear1,
              backgroundColor:"rgba(255, 154, 68, 0.7)",
              stack:"stack1"
            },
            {
              label:"OV (PVäºˆæ¸¬)",
              data:OVYear1,
              type:"line",
              yAxisID:"yOv",
              borderColor:"rgba(106, 17, 203, 0.8)",
              backgroundColor:"rgba(106, 17, 203, 0.2)",
              fill:true,
              tension:0.3
            }
          ]
        },
        options:{
          responsive:true,
          interaction:{mode:"index", intersect:false},
          plugins:{
            annotation:{
              annotations:(()=>{
                if(achieveIndexYear1===-1)return {};
                return {
                  line1:{
                    type:"line",
                    xMin: achieveIndexYear1,
                    xMax: achieveIndexYear1,
                    borderColor: achieveBorderColor,
                    borderWidth:2,
                    label:{
                      enabled:true,
                      position:"top",
                      content:"é”æˆ",
                      backgroundColor: achieveBgColor,
                      color: achieveBorderColor
                    }
                  }
                };
              })()
            }
          },
          scales:{
            x:{stacked:true},
            y:{
              stacked:true,
              title:{display:true,text:"æ•°å€¤"}
            },
            yOv:{
              position:"right",
              title:{display:true,text:"PV (OV)"},
              grid:{drawOnChartArea:false}
            }
          }
        }
      });

      // 2å¹´
      const dataYear2= simData.slice(12,24);
      const labelsYear2= dataYear2.map((row,i)=>{
        if(i===0||row.newYearBreak){
          return row.monthLabel;
        } else {
          return row.monthLabel.split("å¹´")[1];
        }
      });
      const newRegYear2= dataYear2.map(r=> parseInt(r.newReg||0));
      const lrpYear2= dataYear2.map(r=> parseInt(r.lrp||0));
      const OVYear2= dataYear2.map(r=> parseInt(r.OV.replace(/,/g,"")));

      let achieveIndexYear2= -1;
      if(achieveIndexYear1===-1){
        for(let i=0; i<OVYear2.length; i++){
          if(OVYear2[i]>=goalPV){
            achieveIndexYear2= i;
            break;
          }
        }
      }

      const ctx2= document.getElementById("chartYear2").getContext("2d");
      chart2= new Chart(ctx2, {
        type:"bar",
        data:{
          labels: labelsYear2,
          datasets:[
            {
              label:"æ–°è¦ç™»éŒ²è€…æ•°",
              data:newRegYear2,
              backgroundColor:"rgba(252, 96, 118, 0.7)",
              stack:"stack2"
            },
            {
              label:"LRPç¶™ç¶šè€…æ•°",
              data:lrpYear2,
              backgroundColor:"rgba(255, 154, 68, 0.7)",
              stack:"stack2"
            },
            {
              label:"OV (PVäºˆæ¸¬)",
              data:OVYear2,
              type:"line",
              yAxisID:"yOv2",
              borderColor:"rgba(106, 17, 203, 0.8)",
              backgroundColor:"rgba(106, 17, 203, 0.2)",
              fill:true,
              tension:0.3
            }
          ]
        },
        options:{
          responsive:true,
          interaction:{mode:"index", intersect:false},
          plugins:{
            annotation:{
              annotations:(()=>{
                if(achieveIndexYear2===-1)return {};
                return {
                  line2:{
                    type:"line",
                    xMin: achieveIndexYear2,
                    xMax: achieveIndexYear2,
                    borderColor: achieveBorderColor,
                    borderWidth:2,
                    label:{
                      enabled:true,
                      position:"top",
                      content:"é”æˆ",
                      backgroundColor: achieveBgColor,
                      color: achieveBorderColor
                    }
                  }
                };
              })()
            }
          },
          scales:{
            x:{stacked:true},
            y:{
              stacked:true,
              title:{display:true,text:"æ•°å€¤"}
            },
            yOv2:{
              position:"right",
              title:{display:true,text:"PV (OV)"},
              grid:{drawOnChartArea:false}
            }
          }
        }
      });
    }

    // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’CSVã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    function exportToCSV(simData) {
      // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ
      const headers = [
        "æœˆ", "ã‚µãƒ³ãƒ—ãƒ«é…å¸ƒæ•°", "è¬›åº§å‚åŠ æ•°", "æ–°è¦ç™»éŒ²è€…æ•°", 
        "LRPç¶™ç¶šè€…æ•°", "Useræ•°", "ã‚·ã‚§ã‚¢ãƒ©ãƒ¼", "ãƒ“ãƒ«ãƒ€ãƒ¼è‚²æˆæ•°", "OV (PVäºˆæ¸¬)"
      ];
      
      // BOMï¼ˆByte Order Markï¼‰ã‚’è¿½åŠ ã—ã¦æ—¥æœ¬èªã®æ–‡å­—åŒ–ã‘ã‚’é˜²æ­¢
      let csvContent = "\uFEFF";
      
      // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’è¿½åŠ 
      csvContent += headers.join(",") + "\n";
      
      // ãƒ‡ãƒ¼ã‚¿è¡Œã‚’è¿½åŠ 
      simData.forEach(row => {
        const csvRow = [
          row.monthLabel,
          row.sample,
          row.lecture,
          row.newReg,
          row.lrp,
          row.user,
          row.sharer,
          row.builder,
          row.OV.replace(/,/g, "") // ã‚«ãƒ³ãƒã‚’å‰Šé™¤
        ];
        csvContent += csvRow.join(",") + "\n";
      });
      
      try {
        // Blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
        const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
        
        // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’ä½œæˆ
        const link = document.createElement("a");
        const url = URL.createObjectURL(blob);
        
        link.setAttribute("href", url);
        link.setAttribute("download", "ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœ_" + new Date().toISOString().split('T')[0] + ".csv");
        link.style.visibility = "hidden";
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        console.log("CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸ");
      } catch (error) {
        console.error("CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:", error);
        alert("ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
      }
    }

    // ã‚·ãƒŠãƒªã‚ªç®¡ç†æ©Ÿèƒ½
    function saveCurrentScenario(name) {
      // ç¾åœ¨ã®å…¥åŠ›å€¤ã‚’å–å¾—
      const scenarioData = {
        name: name || `ã‚·ãƒŠãƒªã‚ª ${new Date().toLocaleString()}`,
        currentPV: parseFloat(document.getElementById("currentPV").value) || 3000,
        yearGoal: document.getElementById("yearGoal").value,
        goalPV: parseFloat(document.getElementById("goalPV").value) || 9000,
        monthlyTarget: parseFloat(document.getElementById("monthlyTarget").value) || 7,
        targetDate: document.getElementById("targetDate").value,
        timestamp: new Date().getTime()
      };
      
      // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰æ—¢å­˜ã®ã‚·ãƒŠãƒªã‚ªã‚’å–å¾—
      let savedScenarios = JSON.parse(localStorage.getItem("kpiScenarios")) || [];
      
      // æ–°ã—ã„ã‚·ãƒŠãƒªã‚ªã‚’è¿½åŠ 
      savedScenarios.push(scenarioData);
      
      // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
      localStorage.setItem("kpiScenarios", JSON.stringify(savedScenarios));
      
      // ã‚·ãƒŠãƒªã‚ªãƒªã‚¹ãƒˆã‚’æ›´æ–°
      updateScenarioList();
      
      return scenarioData;
    }
    
    function loadScenario(scenarioData) {
      // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å€¤ã‚’è¨­å®š
      document.getElementById("currentPV").value = scenarioData.currentPV;
      document.getElementById("yearGoal").value = scenarioData.yearGoal;
      document.getElementById("goalPV").value = scenarioData.goalPV;
      document.getElementById("monthlyTarget").value = scenarioData.monthlyTarget;
      document.getElementById("targetDate").value = scenarioData.targetDate;
      
      // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
      onUpdate();
    }
    
    function deleteScenario(index) {
      // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰æ—¢å­˜ã®ã‚·ãƒŠãƒªã‚ªã‚’å–å¾—
      let savedScenarios = JSON.parse(localStorage.getItem("kpiScenarios")) || [];
      
      // æŒ‡å®šã•ã‚ŒãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ã‚·ãƒŠãƒªã‚ªã‚’å‰Šé™¤
      savedScenarios.splice(index, 1);
      
      // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
      localStorage.setItem("kpiScenarios", JSON.stringify(savedScenarios));
      
      // ã‚·ãƒŠãƒªã‚ªãƒªã‚¹ãƒˆã‚’æ›´æ–°
      updateScenarioList();
    }
    
    function updateScenarioList() {
      const scenarioList = document.querySelector(".scenario-list");
      
      // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ã‚·ãƒŠãƒªã‚ªã‚’å–å¾—
      const savedScenarios = JSON.parse(localStorage.getItem("kpiScenarios")) || [];
      
      // ã‚·ãƒŠãƒªã‚ªãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢
      scenarioList.innerHTML = "";
      
      if (savedScenarios.length === 0) {
        scenarioList.innerHTML = "<div class='scenario-item'>ä¿å­˜ã•ã‚ŒãŸã‚·ãƒŠãƒªã‚ªã¯ã‚ã‚Šã¾ã›ã‚“</div>";
        return;
      }
      
      // å„ã‚·ãƒŠãƒªã‚ªã‚’ãƒªã‚¹ãƒˆã«è¿½åŠ 
      savedScenarios.forEach((scenario, index) => {
        const scenarioItem = document.createElement("div");
        scenarioItem.className = "scenario-item";
        
        // æ—¥ä»˜ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        const date = new Date(scenario.timestamp);
        const dateStr = `${date.getFullYear()}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
        
        scenarioItem.innerHTML = `
          <div>
            <strong>${scenario.name}</strong><br>
            <small>${dateStr}</small><br>
            <small>PV: ${Number(scenario.currentPV).toLocaleString()} â†’ ${Number(scenario.goalPV).toLocaleString()}, æ–°è¦: ${scenario.monthlyTarget}å/æœˆ</small>
          </div>
          <div class="scenario-actions">
            <button class="scenario-btn load">èª­è¾¼</button>
            <button class="scenario-btn delete">å‰Šé™¤</button>
          </div>
        `;
        
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¿½åŠ 
        const loadBtn = scenarioItem.querySelector(".load");
        const deleteBtn = scenarioItem.querySelector(".delete");
        
        loadBtn.addEventListener("click", () => loadScenario(scenario));
        deleteBtn.addEventListener("click", () => {
          if (confirm(`ã‚·ãƒŠãƒªã‚ªã€Œ${scenario.name}ã€ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`)) {
            deleteScenario(index);
          }
        });
        
        scenarioList.appendChild(scenarioItem);
      });
    }
    
    // Y2Ké¢¨ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœã®å®Ÿè£…
    function createParticles() {
      const particleContainer = document.createElement('div');
      particleContainer.className = 'particle-container';
      document.body.appendChild(particleContainer);
      
      // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã®æ•°
      const particleCount = 20;
      
      // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚’ç”Ÿæˆ
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        // ãƒ©ãƒ³ãƒ€ãƒ ãªã‚µã‚¤ã‚º
        const size = Math.random() * 10 + 5;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        
        // ãƒ©ãƒ³ãƒ€ãƒ ãªä½ç½®
        particle.style.left = `${Math.random() * 100}vw`;
        particle.style.bottom = `-${size}px`;
        
        // ãƒ©ãƒ³ãƒ€ãƒ ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é…å»¶ã¨æ™‚é–“
        const delay = Math.random() * 15;
        const duration = Math.random() * 30 + 15;
        particle.style.animation = `float ${duration}s ${delay}s infinite linear`;
        
        // ãƒ©ãƒ³ãƒ€ãƒ ãªä¸é€æ˜åº¦
        particle.style.opacity = Math.random() * 0.6 + 0.2;
        
        particleContainer.appendChild(particle);
      }
    }
    
    // ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®è¿½åŠ 
    function addButtonHoverEffects() {
      const buttons = document.querySelectorAll('button');
      buttons.forEach(button => {
        button.classList.add('button-hover');
      });
    }
    
    // å…¥åŠ›å€¤å¤‰æ›´ã®æ¤œå‡ºã¨ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã®é »åº¦åˆ¶å¾¡ï¼ˆãƒ‡ãƒã‚¦ãƒ³ã‚¹å‡¦ç†ï¼‰
    function debounce(func, wait) {
      let timeout;
      return function() {
        const context = this;
        const args = arguments;
        clearTimeout(timeout);
        timeout = setTimeout(() => {
          func.apply(context, args);
        }, wait);
      };
    }

    window.addEventListener("DOMContentLoaded", ()=>{
      // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœã®ç”Ÿæˆ
      createParticles();
      
      // ãƒœã‚¿ãƒ³ã«ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ 
      addButtonHoverEffects();
      
      // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®é€£å‹•å‡¦ç†
      function setupSlider(inputId, sliderId, valueDisplayId, min, max, step) {
        const input = document.getElementById(inputId);
        const slider = document.getElementById(sliderId);
        const valueDisplay = slider.nextElementSibling;
        
        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼å€¤å¤‰æ›´ã§å…¥åŠ›å€¤ã‚’åŒæœŸ
        slider.addEventListener("input", function() {
          input.value = this.value;
          valueDisplay.textContent = Number(this.value).toLocaleString();
          debouncedUpdate();
        });
        
        // å…¥åŠ›å€¤å¤‰æ›´ã§ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’åŒæœŸ
        input.addEventListener("input", function() {
          let value = parseInt(this.value) || 0;
          if (value > max) value = max;
          if (value < min) value = min;
          slider.value = value;
          valueDisplay.textContent = Number(value).toLocaleString();
        });
      }
      
      // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      setupSlider("currentPV", "currentPVSlider", null, 0, 50000, 500);
      setupSlider("goalPV", "goalPVSlider", null, 0, 200000, 1000);
      
      // ãƒ—ãƒ©ã‚¹/ãƒã‚¤ãƒŠã‚¹ãƒœã‚¿ãƒ³ã®å‡¦ç†
      const decreaseBtn = document.querySelector(".number-btn.decrease");
      const increaseBtn = document.querySelector(".number-btn.increase");
      const monthlyTargetInput = document.getElementById("monthlyTarget");
      
      decreaseBtn.addEventListener("click", function() {
        let currentValue = parseInt(monthlyTargetInput.value) || 0;
        if (currentValue > 0) {
          monthlyTargetInput.value = currentValue - 1;
          debouncedUpdate();
        }
      });
      
      increaseBtn.addEventListener("click", function() {
        let currentValue = parseInt(monthlyTargetInput.value) || 0;
        if (currentValue < 1000) {
          monthlyTargetInput.value = currentValue + 1;
          debouncedUpdate();
        }
      });
      
      // ã‚·ãƒŠãƒªã‚ªä¿å­˜ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
      document.getElementById("saveScenarioBtn").addEventListener("click", () => {
        const scenarioName = document.getElementById("scenarioName").value;
        saveCurrentScenario(scenarioName);
        document.getElementById("scenarioName").value = "";
      });
      
      // åˆæœŸè¡¨ç¤ºæ™‚ã«ã‚·ãƒŠãƒªã‚ªãƒªã‚¹ãƒˆã‚’æ›´æ–°
      updateScenarioList();
      
      // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
      document.getElementById("exportBtn").addEventListener("click", () => {
        const simData = recalcKpiData();
        exportToCSV(simData);
      });
      
      // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°æ©Ÿèƒ½ã®å®Ÿè£…
      const inputFields = ["currentPV", "yearGoal", "goalPV", "monthlyTarget", "targetDate"];
      const debouncedUpdate = debounce(onUpdate, 500); // 500mså¾Œã«æ›´æ–°
      
      inputFields.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          element.addEventListener("input", debouncedUpdate);
          // selectã®å ´åˆã¯changeã‚¤ãƒ™ãƒ³ãƒˆã‚‚ç›£è¦–
          if (element.tagName === "SELECT") {
            element.addEventListener("change", debouncedUpdate);
          }
        }
      });
      
      // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
      const addTooltip = (elementId, tooltipText) => {
        const element = document.getElementById(elementId);
        if (!element) return;
        
        const tooltipIcon = document.createElement("span");
        tooltipIcon.className = "tooltip-icon";
        tooltipIcon.innerHTML = "â“˜";
        tooltipIcon.style.position = "absolute";
        tooltipIcon.style.right = "10px";
        tooltipIcon.style.top = "10px";
        tooltipIcon.style.color = "#6a11cb";
        tooltipIcon.style.cursor = "help";
        
        const tooltipContent = document.createElement("div");
        tooltipContent.className = "tooltip-content";
        tooltipContent.innerHTML = tooltipText;
        tooltipContent.style.display = "none";
        tooltipContent.style.position = "absolute";
        tooltipContent.style.background = "linear-gradient(45deg, rgba(106, 17, 203, 0.9), rgba(37, 117, 252, 0.9))";
        tooltipContent.style.padding = "10px";
        tooltipContent.style.borderRadius = "8px";
        tooltipContent.style.boxShadow = "0 3px 10px rgba(0,0,0,0.2)";
        tooltipContent.style.zIndex = "100";
        tooltipContent.style.width = "200px";
        tooltipContent.style.fontSize = "0.8rem";
        tooltipContent.style.right = "0";
        tooltipContent.style.top = "30px";
        tooltipContent.style.color = "white";
        tooltipContent.style.border = "1px solid rgba(255, 255, 255, 0.3)";
        
        // ç‰¹åˆ¥ãªã‚±ãƒ¼ã‚¹: æ–°è¦ç™»éŒ²è€…æ•°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
        if (elementId === "monthlyTarget") {
          tooltipIcon.style.right = "-25px";
        }
        
        element.parentNode.style.position = "relative";
        element.parentNode.appendChild(tooltipIcon);
        element.parentNode.appendChild(tooltipContent);
        
        tooltipIcon.addEventListener("mouseenter", () => {
          tooltipContent.style.display = "block";
        });
        
        tooltipIcon.addEventListener("mouseleave", () => {
          tooltipContent.style.display = "none";
        });
      };
      
      // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã®è¿½åŠ 
      addTooltip("currentPV", "ç¾åœ¨ã®PVï¼ˆãƒã‚¤ãƒ³ãƒˆãƒãƒªãƒ¥ãƒ¼ï¼‰ã®å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
      addTooltip("yearGoal", "é”æˆã—ãŸã„ä»Šå¹´ã®ç›®æ¨™ãƒ©ãƒ³ã‚¯ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
      addTooltip("goalPV", "é”æˆã—ãŸã„ç›®æ¨™PVã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
      addTooltip("monthlyTarget", "æ¯æœˆã®æ–°è¦ç™»éŒ²è€…æ•°ã®ç›®æ¨™å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
      addTooltip("targetDate", "ã„ã¤ã‹ã‚‰ç›®æ¨™é”æˆã«å‘ã‘ã¦å–ã‚Šçµ„ã‚€ã‹è¨­å®šã—ã¦ãã ã•ã„ã€‚");
      
      onUpdate();
    });
  </script>
</body>
</html>
